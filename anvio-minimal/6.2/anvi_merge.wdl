version 1.0

task AnviMerge {
  input {
    String? contigs_db
    String? output_dir
    String? sample_name
    String? description
    Boolean? skip_hierarchical_clustering
    Boolean? enforce_hierarchical_clustering
    String? distance
    String? linkage
    Boolean? overwrite_output_destinations
  }
  command <<<
    anvi-merge \
      ~{if defined(contigs_db) then ("--contigs-db " +  '"' + contigs_db + '"') else ""} \
      ~{if defined(output_dir) then ("--output-dir " +  '"' + output_dir + '"') else ""} \
      ~{if defined(sample_name) then ("--sample-name " +  '"' + sample_name + '"') else ""} \
      ~{if defined(description) then ("--description " +  '"' + description + '"') else ""} \
      ~{true="--skip-hierarchical-clustering" false="" skip_hierarchical_clustering} \
      ~{true="--enforce-hierarchical-clustering" false="" enforce_hierarchical_clustering} \
      ~{if defined(distance) then ("--distance " +  '"' + distance + '"') else ""} \
      ~{if defined(linkage) then ("--linkage " +  '"' + linkage + '"') else ""} \
      ~{true="--overwrite-output-destinations" false="" overwrite_output_destinations}
  >>>
  parameter_meta {
    contigs_db: "Anvi'o contigs database generated by 'anvi-gen- contigs'"
    output_dir: "Directory path for output files"
    sample_name: "It is important to set a sample name (using only ASCII letters and digits and without spaces) that is unique (considering all others). If you do not provide one, anvi'o will try to make up one for you based on other information, although, you should never let the software to decide these things)."
    description: "A plain text file that contains some description about the project. You can use Markdwon syntax. The description text will be rendered and shown in all relevant interfaces, including the anvi'o interactive interface, or anvi'o summary outputs."
    skip_hierarchical_clustering: "If you are not planning to use the interactive interface (or if you have other means to add a tree of contigs in the database) you may skip the step where hierarchical clustering of your items are preformed based on default clustering recipes matching to your database type."
    enforce_hierarchical_clustering: "If you have more than 25,000 splits in your merged profile, anvi-merge will automatically skip the hierarchical clustering of splits (by setting --skip- hierarchical-clustering flag on). This is due to the fact that computational time required for hierarchical clustering increases exponentially with the number of items being clustered. Based on our experience we decided that 25,000 splits is about the maximum we should try. However, this is not a theoretical limit, and you can overwrite this heuristic by using this flag, which would tell anvi'o to attempt to cluster splits regardless."
    distance: "The distance metric for the hierarchical clustering. If you do not use this flag, the default distance metric will be used for each clustering configuration which is \"euclidean\"."
    linkage: "The same story with the `--distance`, except, the system default for this one is ward."
    overwrite_output_destinations: "Overwrite if the output files and/or directories exist."
  }
}