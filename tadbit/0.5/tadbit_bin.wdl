version 1.0

task TadbitBin {
  input {
    File? workdir
    Int? resolution
    Boolean? nox
    File? bam
    Int? jobid
    Boolean? force
    Boolean? quiet
    File? tmp_db
    Int? n_chunks
    Int? cpus
    Array[Int] filter
    File? biases
    Array[String] norm
    Boolean? matrix
    Boolean? cooler
    Boolean? row_names
    Boolean? only_plot
    Boolean? interactive
    Boolean? _coord_coordinate_retrieve_genomearguments
    Boolean? c_two
    Boolean? only_txt
    Boolean? plot
    Boolean? force_plot
    Boolean? triangular
    Int? x_tick_rotation
    String? cmap
    String? bad_color
    File? format
    Int? z_range
    String? transform
    Int? fig_size
  }
  command <<<
    tadbit bin \
      ~{if defined(workdir) then ("--workdir " +  '"' + workdir + '"') else ""} \
      ~{if defined(resolution) then ("--resolution " +  '"' + resolution + '"') else ""} \
      ~{if (nox) then "--noX" else ""} \
      ~{if defined(bam) then ("--bam " +  '"' + bam + '"') else ""} \
      ~{if defined(jobid) then ("--jobid " +  '"' + jobid + '"') else ""} \
      ~{if (force) then "--force" else ""} \
      ~{if (quiet) then "--quiet" else ""} \
      ~{if defined(tmp_db) then ("--tmpdb " +  '"' + tmp_db + '"') else ""} \
      ~{if defined(n_chunks) then ("--nchunks " +  '"' + n_chunks + '"') else ""} \
      ~{if defined(cpus) then ("--cpus " +  '"' + cpus + '"') else ""} \
      ~{if defined(filter) then ("--filter " +  '"' + filter + '"') else ""} \
      ~{if defined(biases) then ("--biases " +  '"' + biases + '"') else ""} \
      ~{if defined(norm) then ("--norm " +  '"' + norm + '"') else ""} \
      ~{if (matrix) then "--matrix" else ""} \
      ~{if (cooler) then "--cooler" else ""} \
      ~{if (row_names) then "--rownames" else ""} \
      ~{if (only_plot) then "--only_plot" else ""} \
      ~{if (interactive) then "--interactive" else ""} \
      ~{if (_coord_coordinate_retrieve_genomearguments) then "-c" else ""} \
      ~{if (c_two) then "-c2" else ""} \
      ~{if (only_txt) then "--only_txt" else ""} \
      ~{if (plot) then "--plot" else ""} \
      ~{if (force_plot) then "--force_plot" else ""} \
      ~{if (triangular) then "--triangular" else ""} \
      ~{if defined(x_tick_rotation) then ("--xtick_rotation " +  '"' + x_tick_rotation + '"') else ""} \
      ~{if defined(cmap) then ("--cmap " +  '"' + cmap + '"') else ""} \
      ~{if defined(bad_color) then ("--bad_color " +  '"' + bad_color + '"') else ""} \
      ~{if defined(format) then ("--format " +  '"' + format + '"') else ""} \
      ~{if defined(z_range) then ("--zrange " +  '"' + z_range + '"') else ""} \
      ~{if defined(transform) then ("--transform " +  '"' + transform + '"') else ""} \
      ~{if defined(fig_size) then ("--figsize " +  '"' + fig_size + '"') else ""}
  >>>
  parameter_meta {
    workdir: "path to working directory (generated with the tool tadbit mapper)"
    resolution: "resolution at which to output matrices"
    nox: "no display server (X screen)"
    bam: "path to a TADbit-generated BAM file with all reads (other wise the\\ntool will guess from the working directory database)"
    jobid: "Use as input data generated by a job with a given jobid. Use tadbit\\ndescribe to find out which."
    force: "overwrite previously run job"
    quiet: "remove all messages"
    tmp_db: "if provided uses this directory to manipulate the database"
    n_chunks: "maximum number of chunks into which to cut the BAM"
    cpus: "[8] Maximum number of CPU cores available in the execution host. If\\nhigher than 1, tasks with multi-threading capabilities will enabled\\n(if 0 all available) cores will be used"
    filter: "[[1, 2, 3, 4, 6, 7, 9, 10]] Use filters to define a set os valid\\npair of reads e.g.: '--apply 1 2 3 4 8 9 10'. Where these\\nnumberscorrespond to: 0: nothing, 1: self-circle, 2: dangling-end,\\n3: error, 4: extra dangling-end, 5: too close from RES, 6: too\\nshort, 7: too large, 8: over-represented, 9: duplicated, 10: random\\nbreaks, 11: trans-chromosomic"
    biases: "path to file with pre-calculated biases by columns"
    norm: "[['raw']] normalization(s) to apply. Choices are: [norm, decay, raw,\\nraw&decay]"
    matrix: "Write text matrix in multiple columns (square). By defaults matrices\\nare written in BED-like format (also only way to get a raw matrix\\nwith all values including the ones in masked columns)."
    cooler: "Write i,j,v matrix in cooler format instead of text."
    row_names: "To store row names in the output text matrix. WARNING: when non-\\nmatrix, results in two extra columns"
    only_plot: "[False] Skip writing matrix in text format."
    interactive: "[False] Open matplotlib interactive plot (nothing will be saved)."
    _coord_coordinate_retrieve_genomearguments: ", --coord             Coordinate of the region to retrieve. By default all genome,\\narguments can be either one chromosome name, or the coordinate in\\nthe form: \\\"-c chr3:110000000-120000000\\\""
    c_two: ", --coord2           Coordinate of a second region to retrieve the matrix in the\\nintersection with the first region."
    only_txt: "Save only text file for matrices, not images"
    plot: "Plot matrix in desired format."
    force_plot: "Force plotting even with demoniacally big matrices (more than\\n5000x5000, or 1500x1500with interactive option)."
    triangular: "[False] represents only half matrix. Note that this also results in\\ntruly vectorial images of matrix."
    x_tick_rotation: "[-25] x-tick rotation"
    cmap: "[viridis] Matplotlib color map to use."
    bad_color: "[white] Matplotlib color to use on bins filtered out (only used with\\nnormalized matrices, not raw)."
    format: "[png] plot file format."
    z_range: "Range, in log2 scale of the color scale. i.e.: --zrange=-2,2"
    transform: "[log2] can be any of [log2, log, none]"
    fig_size: "Range, in log2 scale of the color scale. default for triangular\\nmatrices: --figsize=16,10 and for square matrices: --figsize=16,14\\n"
  }
  output {
    File out_stdout = stdout()
  }
}