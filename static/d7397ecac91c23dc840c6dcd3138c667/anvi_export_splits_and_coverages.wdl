version 1.0

task AnviExportSplitsAndCoverages {
  input {
    String? profile_db
    String? contigs_db
    String? output_dir
    File? output_file_prefix
    Boolean? splits_mode
    Boolean? report_contigs
    Boolean? use_q_two_q_three_coverages
  }
  command <<<
    anvi-export-splits-and-coverages \
      ~{if defined(profile_db) then ("--profile-db " +  '"' + profile_db + '"') else ""} \
      ~{if defined(contigs_db) then ("--contigs-db " +  '"' + contigs_db + '"') else ""} \
      ~{if defined(output_dir) then ("--output-dir " +  '"' + output_dir + '"') else ""} \
      ~{if defined(output_file_prefix) then ("--output-file-prefix " +  '"' + output_file_prefix + '"') else ""} \
      ~{true="--splits-mode" false="" splits_mode} \
      ~{true="--report-contigs" false="" report_contigs} \
      ~{true="--use-Q2Q3-coverages" false="" use_q_two_q_three_coverages}
  >>>
  parameter_meta {
    profile_db: "Anvi'o profile database"
    contigs_db: "Anvi'o contigs database generated by 'anvi-gen- contigs'"
    output_dir: "Directory path for output files"
    output_file_prefix: "A prefix to be used while naming the output files (no file type extensions please; just a prefix)."
    splits_mode: "Specify this flag if you would like to output coverages of individual 'splits', rather than their 'parent' contig coverages."
    report_contigs: "By default this program reports sequences and their coverages for 'splits'. By using this flag, you can report contig sequences and coverages instead. For obvious reasons, you can't use this flag with `--splits-mode` flag."
    use_q_two_q_three_coverages: "By default this program reports the mean coverage of a split (or contig, see --report-contigs) for each sample. By using this flag, you can report the mean Q2Q3 coverage by excluding 25 percent of the nucleotide positions with the smallest coverage values, and 25 percent of the nucleotide positions with the largest coverage values. The hope is that this removes 'outlier' positions resulting from non- specific mapping, etc. that skew the mean coverage estimate."
  }
}