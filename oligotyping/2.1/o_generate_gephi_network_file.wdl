version 1.0

task OGenerateGephiNetworkFile {
  input {
    File? sample_mapping
    File? unit_mapping
    Int? sample_size
    Int? unit_size
    Int? min_abundance
    Int? min_sum_normalized_percent
    Boolean? skip_sample_labels
    Boolean? skip_unit_labels
    File file
  }
  command <<<
    o-generate-gephi-network-file \
      ~{file} \
      ~{if defined(sample_mapping) then ("--sample-mapping " +  '"' + sample_mapping + '"') else ""} \
      ~{if defined(unit_mapping) then ("--unit-mapping " +  '"' + unit_mapping + '"') else ""} \
      ~{if defined(sample_size) then ("--sample-size " +  '"' + sample_size + '"') else ""} \
      ~{if defined(unit_size) then ("--unit-size " +  '"' + unit_size + '"') else ""} \
      ~{if defined(min_abundance) then ("--min-abundance " +  '"' + min_abundance + '"') else ""} \
      ~{if defined(min_sum_normalized_percent) then ("--min-sum-normalized-percent " +  '"' + min_sum_normalized_percent + '"') else ""} \
      ~{true="--skip-sample-labels" false="" skip_sample_labels} \
      ~{true="--skip-unit-labels" false="" skip_unit_labels}
  >>>
  parameter_meta {
    sample_mapping: "Providing a sample mapping file will make Gephi file much more useful."
    unit_mapping: "Structurally, unit mapping is identical to sample mapping file, instead, it describes properties of units."
    sample_size: "Sample node size. Default: 8"
    unit_size: "Unit node size. Default: 2"
    min_abundance: "Minimum abundance of a unit to be included in the network. It usually a good idea to give some cut-off since each unit (whether it is an oligotype or an MED node) is going to be a part of the network (total number of reads divided by 10,000 might be a good start)."
    min_sum_normalized_percent: "This defines the minimum sum normalized percent for an oligotype or MED node in a sample to form an edge in the network. Sum normalization takes an oligotype or MED node, generates a vector from its percent occurence in all samples, then normalizes the percent abundances so the total of the vector adds up to 100%. The default is 1, but it might be a good idea to set it to 0 for samples with a lot of samples (such as more than 100 samples)."
    skip_sample_labels: "Leave sample labels blank."
    skip_unit_labels: "Leave unit labels blank."
    file: "Environment file that is generated by the pipeline"
  }
}